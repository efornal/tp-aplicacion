%\documentclass[conference,spanish,a4paper,10pt,oneside,final]{IEEEtran}
\nonstopmode
\documentclass[conference,spanish,a4paper,10pt,oneside,final]{tfmpd}

\include{conf/preconfig}
\include{conf/packages}
%
% Propiedades del documento: título, autor, etc
%
%% \newcommand{\titulo}{{\large FICH --- UNL}\\Procesamiento Digital de Imágenes
%% 2010\\Trabajo Final}
%% \newcommand{\autor}{Fornal, Esteban \and Pfarher, Christian \and Torrez, Mauro}
%% \newcommand{\fecha}{\today}
%% \newcommand{\tituloPDF}{Trabajo Final PDI 2010}
%% \newcommand{\autorPDF}{Fornal, Pfarher, Torrez}
%% \newcommand{\asuntoPDF}{}
%% \newcommand{\clavesPDF}{}
%
\include{conf/config}
%\include{conf/comandos}
%
\begin{document}
\title{Identificación de edificios y monumentos a partir de fotografías
tomadas con dispositivos móviles}
\author{Esteban C. Fornal, Christian N. Pfarher, Mauro J. Torrez\\
\textit{Trabajo práctico final de ``Procesamiento Digital de
Imágenes'', II-FICH-UNL.}}
\markboth{Procesamiento Digital de Imágenes: TRABAJO FINAL}{}
\maketitle
%
%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%
\begin{abstract}
%% El objetivo de este trabajo consiste en la identificación de edificios y
%% monumentos, a partir de imágenes obtenidas mediante un dispositivo móvil de
%% características estándar en el mercado. Para dicho propósito se plantearán
%% métodos diferentes, uno mediante extracción de características en el espacio
%% de la Transformada de Hough y otro basado en medidas estadísticas, comparando
%% a cada uno de ellos por separado y finalmente, evaluando el desempeño de la
%% utilización de ambos conjuntamente.
Se presenta un método para la identificación de edificios y monumentos, a
partir de fotografías tomadas con la cámara de un dispositivo móvil.
Para la identificación se extrae un vector de características de la imagen,
que es almacenado en una base de datos para su consulta.
Se presentan dos métodos para la extracción de características en la imagen, uno
basado en la transformada de Hough y otro que utiliza estadísticas de los
histogramas. Se evalúa el desempeño utilizando ambos métodos por separado y en
conjunto, para una base de datos de prueba de unas pocas imágenes.
\end{abstract}
%
%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%
\begin{keywords}
Identificación/reconocimiento de edificios, \eng{building recognition},
histograma, extracción de características, transformada de Hough, clasificación.
\end{keywords}
%
%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%
\section{Introducción}
\PARstart{L}{a} presencia de gran cantidad de dispositivos tecnológicos móviles 
como celulares, PDAs, y otros, poseen mayormente cámaras digitales incorporadas
y han pasado a ser de uso común debido a su facilidad de uso y portabilidad.

%% @TODO ^^ está horrible este priemr párrafo... releer plis...

Muchas personas toman fotografías de paisajes, monumentos o edificios históricos
que por diferentes motivos les resulta de interés conservar.
Surge así la idea de desarrollar una técnica de procesamiento de imágenes
que posibilite la identificación de edificios, monumentos u otros puntos de
de interés y poder así obtener información pertinente
acerca de los mismos. Con este artículo se trata
de hacer un aporte en vías a resolver dicha inquietud.
%
%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%
\section{Método propuesto}
El método que proponemos se basa en la extracción de características de la
imagen y la comparación de éstas con las de una base de datos.
Esta base de datos se genera tomando $X$ imágenes representativas del monumento,
extrayendo sus características y promediándolas para obtener un prototipo
``generalizado'' del monumento/edificio a detectar.

La extracción de características se realiza en este trabajo mediante dos
técnicas diferentes:
\begin{enumerate}
\item extracción de características por transformada de Hough, y
\item extracción de características por estadísticas del histograma.
\end{enumerate}

El entrenamiento de la base de datos se realiza obteniendo las características
para cada imagen, junto con su etiqueta. Para cada etiqueta, se extraen las
características de las $X$ imágenes etiquetadas con la misma, y se guarda un
``prototipo'' obtenido de promediar estas características, junto con la
etiqueta.

La clasificación de las imágenes consiste en encontrar la etiqueta del
prototipo cuyas características minimicen el error cuadrático medio.

%% Lo de las 10+3 imágenes es parte de la prueba; lo de los prototipos
%% está arriba.....
%% Sobre diez de las trece imágenes de cada edificio, se aplicó el método de la
%% Transformada de Hough citado en este artículo, obteniéndose diez vectores
%% representativos (uno por cada imagen) y se procedió a promediar dichos vectores
%% dando como resultado un prototipo por cada edificio. De la misma manera se
%% realizó el mismo proceso, con el método estadístico descripto también en
%% este documento.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\subsection*{Extracción de características mediante Transformada de Hough}
La transformada de Hough nos permite visualizar, a partir de una imagen de
bordes, los parámetros de aquellas rectas\footnote{El procedimiento es general,
sirve para cualquier geometría que se pueda expresar en términos de sus
parámetros. En este trabajo, utilizamos el espacio de los parámetros de las
rectas, el más sencillo.}
que son principales en la imagen.

Para la extracción de características con esta técnica se siguen los siguientes
pasos:
\begin{enumerate}
\item A partir de la imagen original, se obtiene una versión en escala de grises
      promediando los tres canales RGB, y se la escala a un tamaño normalizado.
\item Se obtiene una imagen de sólo bordes, aproximando la magnitud del
      gradiente según
      \begin{equation}
      \label{sob}
      \nabla f \approx |G_x| + |G_y|,
      \end{equation}
      donde $G_x$, $G_y$ son el resultado de aplicar los operadores gradiente
      de Sobel (fig. \ref{masksobel}) a la imagen. 
      Finalmente se umbraliza esta imagen de bordes en $U$:
      \begin{equation}
      \label{umbral}
      f(x)=
      \begin{cases}
      0, & x\leq U\\
      255, & x > U
      \end{cases}
      \end{equation}
\item Con la imagen de bordes umbralizada se calcula la transformada de
      Hough para rectas.
\item Se aplica escalado a la transformada obtenida, llevándola a un tamaño
      pequeño buscando obtener mayor tolerancia tanto en el parámetro angular
      $\theta$ como de distancia $\rho$
\item Se toman $N$ máximos de esta transformada y se guardan en el vector de
      características las coordenadas $(\rho,\theta)$, mapeadas al rango
      $[-1,1]$ obteniendo así un vector de $2N$ valores.
\end{enumerate}
El proceso completo puede verse en la Fig. \ref{procesohough}.
%% Como se puede observar en la Fig. \ref{procesohough}, en el primer paso se
%% obtiene una imagen de un solo canal mediante el promediado de los tres
%% canales RGB. Luego, con el objetivo de disminuir el costo computacional, se
%% realiza un redimensionamiento de la imagen de 640 x 480 pixels a 100x100.
%% Posteriormente, para la detección de bordes se aplica el operador gradiente
%% de sobel (\ref{sob}) y se umbraliza con la función definida en
%% (\ref{umbral}).
\begin{figure}
\begin{center}
\begin{tabular}{|c|c|c|}
\hline -1 & -2 & -1 \\\hline 0 & 0 & 0 \\\hline 1 & 2 & 1 \\\hline
\end{tabular}
\begin{tabular}{|c|c|c|}
\hline -1 & 0 & 1 \\\hline -2 & 0 & 2 \\\hline -1 & 0 & 1 \\\hline
\end{tabular}
\end{center}
\caption{Máscaras de filtrado (operadores gradiente) de Sobel.}
\label{masksobel}
\end{figure}
%% Tras estos pasos, se transforma al espacio de Hough y aquí se aplica
%% nuevamente un redimensionado a tamaño de 40x40 con el fin de tener una
%% tolerancia respecto a $\rho$ y $\theta$ del espacio transformado de Hough.
%% Finalmente, se obtienen las coordenadas $\rho$ y $\theta$ de 50 máximos con
%% las cuales se forma el vector de características representativo de la imagen.
\begin{figure}
\begin{center}
\includegraphics[scale=0.25]{../diagramas/procesohough} 
\end{center}
\caption{Proceso de la imagen mediante el método por T. de Hough}
\label{procesohough}
\end{figure}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\subsection*{Extracción de características por estadísticas del histograma}
A partir de la imagen original, se normaliza su tamaño y se toman 2 ``perfiles
de intensidad'': uno horizontal, calculado promediando cada columna de la
imagen, y otro vertical obtenido al promediar cada fila. Se obtiene un
histograma para la imagen entera y uno para cada perfil, y se guardan en el
vector de características la media aritmética $m$, mediana $M$ (posición del
percentil 50),  y desviación absoluta $D_{\T{abs}}$ respecto de la mediana:
\begin{equation*}
D_{\T{abs}}=\sum_i |x_i - M|
\end{equation*}
Así se han obtenido un vector de 9 valores que caracterizan histogramas de la
imagen entera.

Luego se subdivide la imagen en cuatro cuadrantes, y se obtienen para cada uno
las mismas medidas que se calcularon para la imagen entera.

Así se obtiene un vector de 45 características a partir de histogramas que se
guardarán en la base de datos para comparación.

\begin{figure}
\begin{center}
\includegraphics[scale=0.25]{../diagramas/procesoestadisticas} 
\end{center}
\caption{Proceso de la imagen mediante el método de estadísticas del histograma}
\label{procesoestadisticas}
\end{figure}
\begin{figure}
\begin{center}
\includegraphics[scale=0.25]{../diagramas/dibujo} 
\end{center}
\caption{Imágenes de pruebas utilizadas con los algoritmos}
\label{imagenes}
\end{figure}
%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%
\section{Experimentos y resultados}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\subsection{Descripción de las pruebas}
Para la prueba del método se utilizó validación cruzada, entrenando la base de
datos con 10 imágenes por clase y 3 de prueba por cada clase. Se utilizaron
3 conjuntos de imágenes diferentes, con 5 clases cada uno.

Las imágenes de prueba fueron tomadas con teléfonos celulares corrientes, a una
resolución VGA estándar de 640 píxeles de ancho por 480 de alto, en
diferentes condiciones
de iluminación: día a pleno sol, día nublado, noche, e interior, a monumentos/%
estatuas y edificios en diferentes lugares de la ciudad de Santa Fe, Argentina.
Se muestran en la figura \ref{imagenes} algunos ejemplos.
Los conjuntos se formaron sorteando las 15 clases de imágenes disponibles en
3 de 5 clases cada uno.

Se probaron, en primer lugar, la extracción de características mediante
transformada de Hough y mediante histogramas por separado.

Para el método de Hough se probaron diferentes valores de $U$, el umbral
aplicado a la imagen de bordes, y $N$, el número de máximos en el espacio de
la transformada de Hough a tener en cuenta para armar el vector de $2N$
características.

Para el método de histograma se consideró el histograma del canal de
intensidad en el espacio de colores HSI.

Luego se consideró el rendimiento del método utilizando ambas técnicas en
forma conjunta, para los parámetros de Hough $U$ y $N$ óptimos encontrados.
Se realizó además una prueba para las 15 clases de imágenes en conjunto,
con el objetivo de tener una estimación de cómo escala el método para
mayor número de imágenes.

\subsubsection*{Tasa de error}
Se considera la tasa de error $\%$ del método según:
\begin{equation}
E_\%=100\cdot\frac{\T{número de errores}}{\T{número de pruebas}},
\end{equation}
considerando como error cada prueba en que la imagen es mal etiquetada.

Cabe observar que no se considera como error la vez que el método identifica
una imagen como el monumento acertado, pero en otras
condiciones de iluminación (cuando por ejemplo, la imagen de un monumento
tomada de día es clasificada como la del mismo monumento, pero tomada de noche).
Esta consideración se hace debido a que la detección de bordes elimina la
información de \resalt{luminosidad}  de la imagen; y está claro que no influye
en la clasificación por histograma; ya que éste varía significativamente
entre las versiones de día y noche, en particular, la media y mediana tendrán
valores bastante menores en la imagen nocturna que en aquella tomada de día.
Esto es además consistente con el objetivo del método, que es la correcta
identificación independientemente de las condiciones en que se toma la imagen.
%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\subsection{Resultados}
\begin{table}
\caption{Tasas de error para métodos}
\begin{center}
\begin{tabular}{ccc}
\hline \emph{Método} & \emph{5 clases} & \emph{15 clases}\\ 
\hline Histogramas & 0\% & 0\%\\ 
\hline Hough & 35.5\% & 60.43\%\\ 
\hline Ambos & 2.22\% & 4.17\%\\ 
\hline 
\end{tabular} 
\end{center}
\label{tablaerrores}
\end{table}

Los resultados de las pruebas para el método de Hough se muestran en la figura
\ref{graficaerror}. Se ha tomado un rango de valores representativos de $U$
y $N$ basados en pruebas previas, donde hemos identificado regiones de mínimo
error para $U~\in(60,120)$ y $N~\in(20,60)$.
En la misma figura se puede apreciar que la tasa de error mínima se obtuvo
para un umbral $U = 100$ y unos $N = 30$ máximos (en promedio).
%
%Debemos comentar aquí que para el método de Hough se realizaron una serie de pruebas
%que determinaron el rango representativo a analizar (umbral $U$ entre 60 y 120 y cantidad
%de máximos $N$ entre 20 y 60). 
En la tabla \ref{tablaerrores} se presentan los resultados para las pruebas
iniciales con conjuntos de 5 clases, y la estimación del resultado con
15 clases. 
%Cabe aclarar que en el primer caso se tomó un promedio de los errores
%sobre el conjunto.

Se puede observar que para el método de histogramas la tasa de error fue cero en
ambas pruebas. En tanto que para el método de Hough se obtiene menor tasa de
error con el conjunto de 5 clases que con el de 15 de 35.5\% y 60.43\%
respectivamente.
En la última fila se muestran los resultados de considerar ambos criterios
en conjunto, asignándole un peso equivalente a cada uno. 

\begin{figure}
\begin{center}
\includegraphics[width=8.5cm]{../diagramas/estadistica_noche_iguales} 
\end{center}
\caption{Error de clasificación promedio en función de distintos $U$ y $N$ para
el método de Hough.}
\label{graficaerror}
\end{figure}
%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\subsection{Discusión}
A pesar de la muy buena performance del método de histograma, debemos tener
presente que los conjuntos de imágenes de entrenamiento/prueba para el método
han sido obtenidas en todos los casos a partir de una secuencia tomada en el 
lapso de unos minutos, lo cual implica que las condiciones de iluminación en
cada conjunto son prácticamente iguales. 

Los histogramas miden la distribución estadística de los diferentes niveles
de intensidad presentes en la imagen, luego están estrechamente relacionados
con las condiciones de iluminación de la escena. Por este motivo, tenemos
que los histogramas entre las imágenes de entrenamiento/prueba son, a los
efectos prácticos, idénticos, lo cual explica el buen funcionamiento de este
método.

Se ha probado la técnica de histogramas sobre el canal I del espacio de color
HSI; por lo antes expuesto, debemos tener en cuenta consideraciones similares
para el resto de los canales de la imagen.

En general, se deberá poner énfasis en definir técnicas
de ``normalización'' orientadas a mejorar los resultados en condiciones más
realistas. Se deberá considerar la utilización de métodos de histograma
mejorados, por ejemplo el \emph{histograma de combinación espacial de DCT
ponderada} \cite{wdctsch}, \emph{vectores de coherencia de
color} \cite{Pass96histogramrefinement}, o el procesamiento de
histogramas borrosos presentado en \cite{Konstantinidis2005375}.

Respecto de la extracción de características mediante la transformada de Hough,
vemos que el rendimiento no es tan bueno como en la técnica de histogramas,
sin embargo en varios casos ha sido capaz de identificar correctamente edificios
a pesar de las diferentes condiciones de iluminación (día y noche), el cual
 es un resultado alentador.

No podemos evitar la mención al costo computacional del proceso, que aunque
no es tan elevado como para considerar impráctico el método, sí será una
limitante al considerar implementaciones en tiempo real o de alta velocidad
de respuesta: en una computadora promedio el cálculo se realiza en 1-2 segundos,
luego es esperable que este tiempo se triplique en un dispositivo móvil.

Se deberá considerar la utilización de un detector de bordes como el propuesto
por Canny \cite{canny}, así como tambien técnicas de preprocesamiento de la
imagen, como puede ser el filtrado homomórfico, en pos de mejorar los
resultados obtenidos en nuestras pruebas.

En lo que respecta a la escalabilidad de la base de datos, los resultados no
son particularmente alentadores, lo que nos obliga a considerar otra vez la
utilización de métodos más refinados de histograma y transformada de Hough.
%
%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%
\section{Conclusiones}
Se ha presentado una técnica para la identificación de edificios, monumentos,
esculturas con extracción de características mediante medidas de histograma
y transformada de Hough.

El rendimiento ha sido satisfactorio considerando las restricciones a las
que se han sometido las pruebas.

Se deberá optimizar la implementación para portarlo a dispositivos móviles
con capacidad de procesamiento limitada.

Se hace necesario el preprocesamiento de la imagen, así como la incorporación
de métodos más refinados de extracción de características, para mejorar los
resultados obtenidos y así poder escalar el método a una base de datos de
mayor magnitud.
%
%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%
\section{Trabajos futuros}
A partir del diseño aquí presentado, nos proponemos continuar
investigando esta técnica considerando las siguientes posibilidades:
\begin{itemize}
\item Aplicación de filtrado homomórfico y otros tipos de
      pre-procesamiento en las imágenes.
\item Aplicación de técnicas de \eng{warping} y otras transformaciones en busca
      de lograr invarianza respecto de rotación y escalado de la imagen.
\item Desarrollo de una implementación óptima para dispositivos móviles con
      poder de procesamiento limitado.
\item Desarrollo de técnicas de extracción de características más robustas que
      las aquí presentadas.
\end{itemize}
\nocite{*}
\bibliographystyle{tfmpd}
\bibliography{tfmpd}
\end{document}
