%\documentclass[conference,spanish,a4paper,10pt,oneside,final]{IEEEtran}
%\nonstopmode
\documentclass[conference,a4paper,10pt,oneside,final]{tfmpd}

\include{conf/preconfig}
\include{conf/packages}
%
% Propiedades del documento: título, autor, etc
%
%% \newcommand{\titulo}{{\large FICH --- UNL}\\Procesamiento Digital de Imágenes
%% 2010\\Trabajo Final}
%% \newcommand{\autor}{Fornal, Esteban \and Pfarher, Christian \and Torrez, Mauro}
%% \newcommand{\fecha}{\today}
%% \newcommand{\tituloPDF}{Trabajo Final PDI 2010}
%% \newcommand{\autorPDF}{Fornal, Pfarher, Torrez}
%% \newcommand{\asuntoPDF}{}
%% \newcommand{\clavesPDF}{}
%
\include{conf/config}
%\include{conf/comandos}
%
\begin{document}
\title{Identificación de edificios y monumentos a partir de fotografías
tomadas con dispositivos móviles}
\author{Esteban C. Fornal, Christian N. Pfarher, Mauro J. Torrez\\
\textit{Trabajo práctico final de ``Procesamiento Digital de
Imágenes'', II-FICH-UNL.}}
\markboth{Procesamiento Digital de Imágenes: TRABAJO FINAL}{}
\maketitle
%
%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%
\begin{abstract}
%%
%% El objetivo de este trabajo consiste en la identificación de edificios y
%% monumentos, a partir de imágenes obtenidas mediante un dispositivo móvil de
%% características estándar en el mercado. Para dicho propósito se plantearán
%% métodos diferentes, uno mediante extracción de características en el espacio
%% de la Transformada de Hough y otro basado en medidas estadísticas, comparando
%% a cada uno de ellos por separado y finalmente, evaluando el desempeño de la
%% utilización de ambos conjuntamente.
%% 
Se presenta un método para la identificación de edificios y monumentos, a
partir de fotografías tomadas con la cámara de un dispositivo móvil.
Se extrae un vector de características \iins{globales y locales} de cada imagen.
\iins{Se identifica una imagen de entrada minimizando el error cuadrático medio
entre sus vectores de características y los de una base de datos de imágenes
conocidas.}
Se presentan dos técnicas para la extracción de
características, una basada en la transformada de Hough y otra que
utiliza estadísticas de los histogramas.
Se evalúa el desempeño \tachar{utilizando error cuadrático medio}
de ambas técnicas por separado y en
conjunto, para una base de datos de prueba.
\end{abstract}
%
%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%
\begin{keywords}
Identificación de edificios, \eng{building recognition},
histograma, transformada de Hough, clasificación.
\end{keywords}
%
%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%
\section{Introducción}
%README: esto es lo que estaba antes.. lo deje por las dudas porque al final me
%qued con la duda si habia que corregirlo o no..
%por las dudas corrijo abajo y dejo  la version original...
%
%\PARstart{E}{n} la actualidad, la gran difusión de los dispositivos móviles nos
%permite llevar la información importante siempre con nosotros.
%Es muy común utilizar nuestros celulares, PDAs, además para \emph{obtener}
%información desde donde estamos, gracias a la proliferación de redes de datos
%inalámbricas.
%
%Dado que una gran parte de estos dispositivos además poseen una cámara
%digital, surge la idea de utilizarla junto con las conexiones de datos para
%obtener información acerca del lugar donde nos encontramos.
%
%Se presenta aquí una técnica de Procesamiento Digital de Imágenes orientada
%en este sentido, que permite la
%identificación de edificios, monumentos y otros puntos de interés, a partir
%de una fotografía capturada con un dispositivo móvil.
\PARstart{E}{n} la actualidad, la gran difusión de los dispositivos móviles nos
permite llevar la información importante siempre con nosotros. Además, es muy 
común utilizar nuestros celulares, PDAs, GPS para \emph{obtener}
información desde cualquier lugar donde estemos, gracias a la proliferación de
redes de datos inalámbricas. Dado que una gran parte de estos dispositivos
posee una cámara
digital, surge la idea de utilizarla junto con las conexiones de datos para
obtener información acerca del lugar donde nos encontramos. Se presenta aquí
un método que combina técnicas de Procesamiento Digital de Imágenes orientadas
en este sentido, que permite la
identificación de edificios, monumentos y otros puntos de interés, a partir
de una fotografía capturada con un dispositivo móvil.
%
%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%
\section{Método propuesto}
En el método propuesto se ha puesto énfasis en la etapa de 
extracción de características de la imagen, considerando
un método trivial de clasificación.
La base de datos se generó tomando \Tachar{$X$} imágenes representativas de
%%cada monumento.
%%Se extrajeron sus características y se promediaron %promediándolas 
\iins{cada monumento, se extrajeron sus características y se promediaron}
para obtener un prototipo ``generalizado'' de cada monumento/edificio 
en particular.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\subsection{Extracción de características}
\resalt{¿Es realmente necesario un subtítulo para un solo párrafo?}

La extracción de características se realiza \tachar{\tachar{en este trabajo}}
mediante dos técnicas diferentes:
\begin{enumerate}
\item \Tachar{por} transformada de Hough, y
\item \Tachar{por} estadísticas del histograma.
\end{enumerate}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\subsection{Extracción de características mediante Transformada de Hough}
La transformada de Hough nos permite visualizar, a partir de una imagen de
bordes, los parámetros de aquellas rectas\footnote{El procedimiento es general,
sirve para cualquier geometría que se pueda expresar en términos de sus
parámetros. En este trabajo, se utiliza el espacio de los parámetros de las
rectas, el más sencillo.}
que son principales en la imagen.

Para la extracción de características con esta técnica se siguen los siguientes
pasos:
\begin{enumerate}
\item A partir de la imagen original, se obtiene su versión en escala de grises
      promediando los tres canales RGB, y se la escala a un tamaño normalizado.
\item Se obtiene una imagen de sólo bordes, aproximando la magnitud del
      gradiente según
      \begin{equation}
      \label{sob}
      \nabla f \approx |G_x| + |G_y|,
      \end{equation}
      donde $G_x$, $G_y$ son el resultado de aplicar los o\-pe\-ra\-do\-res
      gradiente  de Sobel \cite{gonzalez+woods} (fig. \ref{masksobel}) a la
      imagen. 
      Finalmente se umbraliza esta imagen de bordes utilizando un parámetro $U$:
      \begin{equation}
      \label{umbral}
      f(I)=
      \begin{cases}
      0, & I\leq U\\
      255, & I > U
      \end{cases}
      \end{equation}
      \iins{donde $I=I(x,y)$ es el valor de la intensidad en el punto $(x,y)$.}
\item Con la imagen de bordes umbralizada se calcula la transformada de
      Hough para rectas.
\item Se aplica un escalado (submuestreo) a la transformada obtenida, llevándola
      a un tamaño pequeño %buscando 
      para obtener mayor tolerancia tanto en el parámetro angular
      $\theta$ como en el de distancia $\rho$.
\item Se toman los $N$ máximos de esta transformada y se guardan en el vector de
      características sus coordenadas $(\rho,\theta)$, mapeadas al rango
      $[-1,1]$, obteniendo así un vector de $2N$ valores.
\end{enumerate}
El proceso completo puede verse en la Fig. \ref{procesohough}.
%% Como se puede observar en la Fig. \ref{procesohough}, en el primer paso se
%% obtiene una imagen de un solo canal mediante el promediado de los tres
%% canales RGB. Luego, con el objetivo de disminuir el costo computacional, se
%% realiza un redimensionamiento de la imagen de 640 x 480 pixels a 100x100.
%% Posteriormente, para la detección de bordes se aplica el operador gradiente
%% de sobel (\ref{sob}) y se umbraliza con la función definida en
%% (\ref{umbral}).
\begin{figure}
\begin{center}
\begin{tabular}{|c|c|c|}
\hline -1 & -2 & -1 \\\hline 0 & 0 & 0 \\\hline 1 & 2 & 1 \\\hline
\end{tabular}
\begin{tabular}{|c|c|c|}
\hline -1 & 0 & 1 \\\hline -2 & 0 & 2 \\\hline -1 & 0 & 1 \\\hline
\end{tabular}
\end{center}
\caption{Máscaras de filtrado (operadores gradiente) de Sobel.}
\label{masksobel}
\end{figure}
%% Tras estos pasos, se transforma al espacio de Hough y aquí se aplica
%% nuevamente un redimensionado a tamaño de 40x40 con el fin de tener una
%% tolerancia respecto a $\rho$ y $\theta$ del espacio transformado de Hough.
%% Finalmente, se obtienen las coordenadas $\rho$ y $\theta$ de 50 máximos con
%% las cuales se forma el vector de características representativo de la imagen.
\begin{figure}
\begin{center}
\includegraphics[scale=0.25]{../diagramas/procesohough} 
\end{center}
\caption{Proceso de extracción de características por Transformada de Hough}
\label{procesohough}
\end{figure}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\subsection{Extracción de características por estadísticas del histograma}
A partir de la imagen original, se normaliza su tamaño y se toman 2 ``perfiles
de intensidad'': uno horizontal, calculado 
promediando % SE PROMEDIA ya que sino se garchan las estadisticas 
cada columna de la
imagen, y otro vertical obtenido al promediar cada fila. También se obtiene un
histograma de la imagen entera. De estos 3 vectores, se calculan
y se guardan en el
vector de características la media aritmética $m$, la mediana $M$ (posición del
percentil 50),  y la desviación absoluta $D_{\T{abs}}$ respecto de la mediana:
\begin{equation*}
D_{\T{abs}}=\sum_i |x_i - M|
\end{equation*}
Así, se ha obtenido un vector de 9 valores que caracterizan % histogramas de la
a la imagen entera.

Con la idea de incorporar características locales,
se subdivide la imagen en cuatro 
cuadrantes y se obtienen, para cada uno, las mismas medidas que se calcularon
para  la imagen entera. Como resultado, se obtiene un vector de 45
características asociado a cada imagen.

\begin{figure}
\begin{center}
\includegraphics[scale=0.25]{../diagramas/procesoestadisticas} 
\end{center}
\caption{Proceso de extracción de características utilizando estadísticas del
histograma.}
\label{procesoestadisticas}
\end{figure}

\subsection{Clasificación}
El entrenamiento de la base de datos se realiza obteniendo las características
para cada imagen, junto a su etiqueta.
Se extraen las características de todas las imágenes 
con la misma etiqueta, y se guarda un
``prototipo'' para esa clase, obtenido de promediar estas características.

La clasificación de las imágenes consiste en
obtener la etiqueta del prototipo, cuyas características 
minimicen el error cuadrático medio con las de
la imagen a identificar.
\iins{agregar formula del ECM y referencial al parrafo de arriba}
%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%
\section{Experimentos y resultados}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\subsection{\iins{Generación de la} base de datos}
Las imágenes de prueba fueron tomadas con teléfonos celulares corrientes, a una
resolución VGA estándar de 640 píxeles de ancho por 480 de alto, en
diferentes condiciones
de iluminación: día a pleno sol, día nublado, noche, e interior, a monumentos/%
estatuas y edificios en diferentes lugares de la ciudad de Santa Fe (Argentina).
\iins{Cada entrada en la base de datos corresponde a una \emph{clase}, que
representa un edificio en una condición de iluminación en particular.}
\iins{Se obtuvieron 195 imágenes, 13 por cada una de 15 clases diferentes en
total.}
Se muestran en la figura \ref{imagenes} dos ejemplos de las mismas.

%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\subsection{Experimentación}
Se generaron 3 \Tachar{conjuntos}\iins{casos} de prueba diferentes, tomando
5 clases al azar (no repetidas) para cada \Tachar{conjunto}\iins{uno}.
Para la prueba del método \Tachar{con cada conjunto}\iins{en cada caso}
se utilizó validación cruzada,
entrenando la base de datos con 10 imágenes por clase, y dejando las 3
imágenes restantes para la prueba.

%% Se utilizaron 3 conjuntos de imágenes diferentes, con 5 clases cada uno.
%% Los conjuntos se formaron sorteando las 15 clases de imágenes disponibles en
%% 3 de 5 clases cada uno. - Marcelo: no queda claro! Explicar simple:''utilizaron
%%  N clases diferentes y se formaron 3 grupos
%% tomando 5 clases por cada uno aleatoria''}

\begin{figure}
\begin{center}
\includegraphics[scale=0.25]{../diagramas/dibujo} 
\end{center}
\caption{Ejemplo de dos imágenes utilizadas para probar el método.\iins{agregar mas fotos ilustrativas}}
\label{imagenes}
\end{figure}

Se 
% probaron, en primer lugar, la 
clasificó utilizando extracción de características mediante
transformada de Hough y mediante histogramas por separado. Para el método de Hough
se probaron diferentes valores de $U$ (el umbral
aplicado a la imagen de bordes) y $N$ (el número de máximos en el espacio de
la transformada de Hough considerado). Mientras que, 
%a tener en cuenta para armar el vector de $2N$ características.
para el método de histograma se consideró el histograma y los perfiles del canal de
intensidad en el espacio de colores HSI.

Luego se evaluó el rendimiento del método utilizando todas las características %ambas técnicas 
en forma conjunta, para los parámetros de Hough $U$ y $N$ óptimos encontrados.

Se realizó además un \iins{caso de prueba} con las 15 clases de
imágenes del conjunto,
con el objetivo de tener una estimación de cómo responde
el método para un mayor número de imágenes.

Se considera la tasa de error ($\%$) del método según:
\begin{equation}
E_\%=100\cdot\frac{\T{número de errores}}{\T{número de pruebas}},
\end{equation}
considerando como error a cada prueba en que la imagen es mal etiquetada.

Cabe destacar que no se considera %como 
``error'' %la vez que 
cuando el método identifica
una imagen como \Tachar{el monumento acertado, pero}\iins{una clase diferente,
si ésta corresponde al mismo monumento} en otras
condiciones de iluminación (cuando por ejemplo, la imagen de un monumento
tomada de día es clasificada como la del mismo monumento, pero tomada de noche).
Esta consideración se hace debido a que la detección de bordes elimina la
información de iluminación de la imagen, y está claro que no influye
en la clasificación por histograma, ya que éste varía significativamente
entre las versiones de día y noche; en particular, la media y mediana tendrán
valores bastante menores en la imagen nocturna que en aquella tomada de día.
Esto es además consistente con el objetivo del método, que es la correcta
identificación independientemente de las condiciones en que se toma la imagen.
%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\subsection{Resultados}
Los resultados de las pruebas con \Tachar{el método}\iins{la técnica} de Hough
se muestran en la figura
\ref{graficaerror}. Se ha tomado un rango de valores representativos de $U$
y $N$ basados en pruebas previas, donde hemos identificado regiones de mínimo
error para $U~\in(60,120)$ y $N~\in(20,60)$.
En la misma figura, se puede apreciar que la tasa de error mínima se obtuvo
para un umbral $U = 100$ y unos $N = 30$ máximos (en promedio).

\begin{figure}
\begin{center}
\includegraphics[width=8.5cm]{../diagramas/estadistica_noche_iguales} 
\end{center}
\caption{Error de clasificación promedio en función de distintos $U$ y $N$ para
\Tachar{el método}\iins{la técnica} de Hough.}
\label{graficaerror}
\end{figure}

En la tabla \ref{tablaerrores} se presentan los resultados para
\Tachar{las pruebas con conjuntos}\iins{los casos de prueba} de 5 clases 
\Tachar{el resultado con}\iins{y para el caso de} 15 clases. 
%
%Cabe aclarar que en el primer caso se tomó un promedio de los errores
%sobre el conjunto.
%
\begin{table}
\caption{Tasas de error para \Tachar{los métodos}\iins{las técnicas de
extracción de características}.}
\begin{center}\begin{tabular}{ccc}
\hline \emph{\Tachar{Método}\iins{Técnica}} & \emph{5 clases} & \emph{15 clases}\\ 
\hline Histogramas & 0\% & 0\%\\ 
\hline Hough & 35.5\% & 60.43\%\\ 
\hline Ambas & 2.22\% & 4.17\%\\ 
\hline 
\end{tabular}\end{center}
\label{tablaerrores}
\end{table}
%
Se puede observar que para \Tachar{el método}\iins{la técnica} de histogramas,
la tasa de error fue cero
en ambas pruebas. En tanto que para \Tachar{el método}\iins{la} de Hough,
se obtiene menor tasa de
error \Tachar{con el conjunto}\iins{en los casos} de 5 clases que con el de
15, de 35.5\% y 60.43\%
respectivamente. En la última fila, se muestran los resultados de
con\-si\-de\-rar
\Tachar{todas las características}\iins{ambas técnicas}
en conjunto, asignándole un peso equivalente a cada una. 
%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\subsection{Discusión}
%% A pesar de la muy buena performance del método de histograma, debemos tener
%% presente que los conjuntos de imágenes de entrenamiento/prueba para el método, 
%% han sido obtenidas en todos los casos a partir de una secuencia tomada en el 
%% lapso de unos minutos, lo cual implica que las condiciones de iluminación en
%% cada conjunto son prácticamente iguales. %\resalt{aclarar antes lode los
%% conjuntos sino aca no se entiende}


A pesar de la muy buena performance de la técnica de histograma, debemos tener
presente que las  imágenes de entrenamiento/prueba han sido obtenidas
en todos los casos a partir de una secuencia tomada en el 
lapso de unos minutos, con el mismo dispositivo, lo cual implica que las
condiciones de iluminación en cada clase son prácticamente iguales.

Los histogramas miden la distribución estadística de los diferentes niveles
de intensidad presentes en la imagen, luego están estrechamente relacionados
con las condiciones de iluminación de la escena. Por este motivo, tenemos
que los histogramas entre las imágenes de entrenamiento/prueba son, \Tachar{a los
efectos prácticos,} similares, lo cual explica el buen funcionamiento de este
método.

Se ha probado la técnica de histogramas sobre el canal I del espacio de color
HSI; por lo antes expuesto, debemos tener en cuenta consideraciones similares
para el resto de los canales de la imagen.

En general, se deberá poner énfasis en definir técnicas
de ``normalización'' orientadas a mejorar los resultados en condiciones más
realistas. Se deberá considerar la utilización de métodos de histograma
mejorados, por ejemplo el \emph{histograma de combinación espacial de DCT
ponderada} \cite{wdctsch}, \emph{vectores de coherencia de
color} \cite{Pass96histogramrefinement}, o el procesamiento de
histogramas borrosos presentado en \cite{Konstantinidis2005375}.

Respecto de la extracción de características mediante la transformada de Hough,
vemos que el rendimiento no es tan bueno como en la técnica de histogramas,
sin embargo en varios casos ha sido capaz de identificar correctamente edificios
a pesar de las diferentes condiciones de iluminación (día y noche), lo cual
es un resultado alentador.

No se puede evitar la mención al costo computacional del proceso, que aunque
no es tan elevado como para considerar impráctico el método, sí será una
limitante al considerar implementaciones en tiempo real o de alta velocidad
de respuesta: en una computadora promedio el cálculo se realiza en 1-2 segundos,
luego es esperable que este tiempo se triplique en un dispositivo móvil.

Se deberá considerar la utilización de un mejor detector de bordes, como el
propuesto por Canny \cite{canny},
así como también técnicas de pre-procesamiento de la
imagen, como puede ser el filtrado homomórfico, en pos de mejorar los
resultados obtenidos en nuestras pruebas.

En lo que respecta a la escalabilidad de la base de datos, los resultados no
son particularmente alentadores, lo que nos \Tachar{obliga}\iins{podría estar
indicando que las características extraídas no son suficientemente \emph{únicas}
para las imágenes, obligándonos} a considerar otra vez la
utilización de métodos más refinados de histograma y transformada de Hough.
%\resalt{esto no lo entiende marcelo}
%
%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%
\section{Conclusiones}
Se ha presentado una técnica para la identificación de edificios, monumentos,
esculturas con extracción de características mediante medidas de histograma
y transformada de Hough.

El rendimiento ha sido satisfactorio considerando las restricciones a las
que se han sometido las pruebas.

Se debe optimizar la implementación para portarlo a dispositivos móviles
con capacidad de procesamiento limitada.

Se hace necesario un preprocesamiento de la imagen, así como la incorporación
de métodos más refinados de extracción de características, para mejorar los
resultados obtenidos y así poder usar el método con una base de datos de
mayor magnitud.
%
%
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%
\section{Trabajos futuros}
A partir del diseño aquí presentado, han surgido líneas para continuar
investigando y lograr un método más robusto:
\begin{itemize}
\item Aplicación de filtrado homomórfico y otros tipos de
      pre-procesamiento en las imágenes.
\item Aplicación de técnicas de \eng{warping} y otras transformaciones en busca
      de lograr invarianza respecto de rotación y escalado de la imagen.
\item Desarrollo de técnicas de extracción de características más
      \Tachar{robustas}\iins{refinadas}.
\item Desarrollo de una implementación óptima para dispositivos móviles con
      poder de procesamiento limitado.
\end{itemize}
\nocite{*}
\bibliographystyle{tfmpd}
\bibliography{tfmpd}
\end{document}
